<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Tool for converting GIFs from video files">
    <meta property="og:title" content="Boris Buliga - High quality GIF from video" />
    <meta property="og:description" content="Tool for converting GIFs from video files" />
    <meta property="og:image" content="https://d12frosted.io/images/d12frosted.png" />
    <meta property="og:url" content="https://d12frosted.io/posts/2018-10-13-gifify.html" />
    <meta property="og:type" content="article" />
    <title>Boris Buliga - High quality GIF from video</title>
    <link rel="stylesheet" href="../css/default.css" />
    <link rel="stylesheet" href="../css/fonts.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
    <link rel="manifest" href="../site.webmanifest">

    <!-- <script defer src="/library/@fortawesome/fontawesome-free/js/solid.js"></script> -->
    <!-- <script defer src="/library/@fortawesome/fontawesome-free/js/brands.js"></script> -->

    <link href="../library/@fortawesome/fontawesome-free/css/fontawesome.min.css" rel="stylesheet">
    <link href="../library/@fortawesome/fontawesome-free/css/brands.min.css" rel="stylesheet">
    <link href="../library/@fortawesome/fontawesome-free/css/solid.min.css" rel="stylesheet">
    <link href="../library/@fortawesome/fontawesome-free/css/regular.min.css" rel="stylesheet">

    <script data-goatcounter="https://d12frosted.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </head>
  <body>
    <header>
      <div class="logo">
        <a href="../">Boris Buliga</a>
      </div>
      <nav>
        <a href="../posts.html" title="Posts">
          <span class="fa-regular fa-file-lines fa-xs"></span>
          Posts
        </a>
        <a href="../projects.html" title="Projects">
          <span class="fa-solid fa-suitcase fa-xs"></span>
          Projects
        </a>
        <!-- <a href="/atom.xml" title="RSS"><span class="fa-solid fa-rss fa-xs"></span>RSS</a> -->
        <a href="https://github.com/d12frosted" title="GitHub">
          <span class="fa-brands fa-github fa-xs"></span>
          GitHub
        </a>
        <a href="https://barberry.io" title="Barberry Garden">
          <span class="fa-solid fa-wine-glass fa-xs"></span>
          Wine
        </a>
      </nav>
    </header>
    
    <main role="main">
      <article>
  <h1>High quality GIF from video</h1>
  <section class="subtitle">
    Posted on October 13, 2018
    
  </section>
  
  <section class="subtitle">
    Updated on July 20, 2022
  </section>
  
  
  <section class="subtitle">
    Tagged as <a title="All pages tagged 'shell'." href="../tags/shell.html">#shell</a>
  </section>
  
  <section>
    <p><img src="../images/2018-10-13-gifify/2022-07-19-20-24-38-gifify-lolcat-regular.gif" class="img-half img-float-left" /></p>
<p><img src="../images/2018-10-13-gifify/2022-07-19-20-24-38-gifify-lolcat-palette.gif" class="img-half img-float-right" /></p>
<p>When it comes to converting video to GIF, one usually gets a huge file and a questionable quality. Most of the guides suggest to use FFmpeg to do the conversion, but usually, they don’t bother with the quality of the result. As it turns out, folks from FFmpeg made some huge steps in improving the GIF output.</p>
<!--more-->

<blockquote>
<p>As you probably know, GIF is limited to a palette of 256 colors. And by default, FFmpeg just uses a generic palette that tries to cover the whole color space in order to support the largest variety of content:</p>
</blockquote>
<p><img src="../images/2018-10-13-gifify/2022-07-19-20-29-03-ffmpeg-default-palette.webp" /></p>
<p>The idea is to generate a custom palette and use it during conversion.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate a palette</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ffmpeg <span class="at">-i</span> input.mov <span class="at">-vf</span> <span class="st">&quot;fps=10,scale=320:-1:flags=lanczos,palettegen palette.png&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># output the GIF using generated palette</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ffmpeg <span class="at">-i</span> input.mov <span class="at">-i</span> palette.png <span class="at">-filter_complex</span> <span class="st">&quot;fps=10,scale=320:-1:flags=lanczos[x];[x][1:v]paletteuse&quot;</span> output.gif</span></code></pre></div>
<p>Since I am not good at remembering this kind of commands (and I hate to cycle the history of commands), I’ve created a simple script for doing exactly this. It’s called <code class="verbatim">gifify</code> and you can find it in my <a href="https://github.com/d12frosted/environment/blob/master/bin/gifify">.environment</a> repository.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gifify <span class="at">-i</span> file.mov <span class="co"># output is file.gif</span></span></code></pre></div>
<p>Strong points of this script:</p>
<ol type="1">
<li><p>You can pass scaling to <code class="verbatim">ffmpeg</code> (usually I don’t want to mess with the actual size). Default value is <code class="verbatim">1</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gifify <span class="at">-i</span> file.mov <span class="at">-s</span> 0.5</span></code></pre></div></li>
<li><p>You can pass FPS to <code class="verbatim">ffmpeg</code>. Default value is <code class="verbatim">24</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gifify <span class="at">-i</span> file.mov <span class="at">-fps</span> 24</span></code></pre></div></li>
<li><p>The output file is defined automatically (input filename extension is changed to <code class="verbatim">gif</code>), but you can specify it manually.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gifify <span class="at">-i</span> file.mov <span class="at">-o</span> /path/to/gifs/mega.gif</span></code></pre></div></li>
<li><p>Allows using default palette (custom one won’t be generated).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gifify <span class="at">-i</span> file.mov <span class="at">--default-palette</span></span></code></pre></div></li>
<li><p>Allows compressing resulting GIF using <code class="verbatim">gifsicle</code>. By default, result is not compressed.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gifify <span class="at">-i</span> file.mov <span class="at">--compress</span></span></code></pre></div></li>
<li><p>You can pass any additional arguments to <code class="verbatim">ffmpeg</code> (like time).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gifify <span class="at">-i</span> file.mov <span class="at">-t</span> 26</span></code></pre></div></li>
</ol>
<p>My concern usually is about quality, not about the physical size if the output. But you have several options here:</p>
<ol type="1">
<li>The lesser FPS is, the lesser output is. In most cases, 15 FPS is good enough.</li>
<li>Use scaling. When it comes to screen video, you rarely need the original size, scale it a bit.</li>
<li>In case you are good with the default palette, just use it.</li>
<li>Use compression provided by <code class="verbatim">gifsicle</code>.</li>
</ol>
<h1 id="f1273041-5435-4b8f-8d36-83b49e65a996" id="palettes-default-vs-custom">Palettes: default vs custom</h1>
<p>Here are several examples, were the difference between default and custom
palette is visible. In the first example, the difference is more obvious than in
others, but still.</p>
<p><img src="../images/2018-10-13-gifify/2022-07-19-20-29-47-gifify-lolcat-regular.gif" class="img-half img-float-left" /></p>
<p><img src="../images/2018-10-13-gifify/2022-07-19-20-29-47-gifify-lolcat-palette.gif" class="img-half img-float-right" /></p>
<p><img src="../images/2018-10-13-gifify/2022-07-19-20-30-26-gifify-screen-regular.gif" class="img-half img-float-left" /></p>
<p><img src="../images/2018-10-13-gifify/2022-07-19-20-30-26-gifify-screen-palette.gif" class="img-half img-float-right" /></p>
<p><img src="../images/2018-10-13-gifify/2022-07-19-20-30-51-gifify-monty-regular.gif" class="img-half img-float-left" /></p>
<p><img src="../images/2018-10-13-gifify/2022-07-19-20-30-51-gifify-monty-palette.gif" class="img-half img-float-right" /></p>
<h1 id="6731df79-e44e-4829-ad36-f9ceeb69c862" id="installation">Installation</h1>
<p>First, you need to install dependencies: <code class="verbatim">ffmpeg</code> and <code class="verbatim">gifsicle</code>. On macOS, you can install them using <code class="verbatim">brew</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> brew install ffmpeg gifsicle</span></code></pre></div>
<p>Then you need to grab the latest version of <code class="verbatim">gifify</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> curl https://raw.githubusercontent.com/d12frosted/environment/master/utils/bin/gifify <span class="op">&gt;</span> /path/to/gifify</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> chmod +x /path/to/gifify</span></code></pre></div>
<p>Note that <code class="verbatim">gifify</code> should be in the folder that is visible from your <code class="verbatim">PATH</code>. I usually put <code class="verbatim">gifify</code> in <code class="verbatim">$HOME/.local/bin</code>.</p>
<h1 id="a6441284-0456-47c4-9f24-4c7f9a3eafe7" id="source-code">Source code</h1>
<p>You can find the latest version on <a href="https://github.com/d12frosted/environment/blob/master/bin/gifify">GitHub</a>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert video to gif</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  gifify -i FILE [OPTIONS]</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># To the list of all options, use</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   gifify --help</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">-e</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="va">POSITIONAL</span><span class="op">=</span><span class="va">()</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="va">SCALE</span><span class="op">=</span>1</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="va">FPS</span><span class="op">=</span>24</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="va">PTS</span><span class="op">=</span>1</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="va">PALETTE</span><span class="op">=</span><span class="st">&quot;custom&quot;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="va">COMPRESS</span><span class="op">=</span>0</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="kw">[[</span> <span class="va">$#</span> <span class="ot">-gt</span> 0 <span class="kw">]]</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="va">key</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">case</span> <span class="va">$key</span> <span class="kw">in</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="ss">-i</span><span class="kw">|</span><span class="ss">--input</span><span class="kw">)</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>      <span class="va">INPUT</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$2</span><span class="st">&quot;</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past argument</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past value</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>      <span class="cf">;;</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="ss">-o</span><span class="kw">|</span><span class="ss">--output</span><span class="kw">)</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>      <span class="va">OUTPUT</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$2</span><span class="st">&quot;</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past argument</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past value</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">;;</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="ss">-s</span><span class="kw">|</span><span class="ss">--scale</span><span class="kw">)</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>      <span class="va">SCALE</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$2</span><span class="st">&quot;</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past argument</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past value</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>      <span class="cf">;;</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="ss">--fps</span><span class="kw">)</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>      <span class="va">FPS</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$2</span><span class="st">&quot;</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past argument</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past value</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">;;</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="ss">--pts</span><span class="kw">)</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>      <span class="va">PTS</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$2</span><span class="st">&quot;</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past argument</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past value</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">;;</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="ss">--default-palette</span><span class="kw">)</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>      <span class="va">PALETTE</span><span class="op">=</span><span class="st">&quot;default&quot;</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past argument</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>      <span class="cf">;;</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    <span class="ss">--compress</span><span class="kw">)</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>      <span class="va">COMPRESS</span><span class="op">=</span>1</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past argument</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">;;</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    <span class="pp">*</span><span class="kw">)</span>    <span class="co"># unknown option</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>      <span class="va">POSITIONAL</span><span class="op">+=</span><span class="va">(</span><span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span><span class="va">)</span> <span class="co"># save it in an array for later</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>      <span class="bu">shift</span> <span class="co"># past argument</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">;;</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">esac</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">${POSITIONAL</span><span class="op">[@]</span><span class="va">}</span><span class="st">&quot;</span> <span class="co"># restore positional parameters</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> print_usage()</span> <span class="kw">{</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">&quot;Usage:</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a><span class="st"> gifify -i FILE [OPTIONS]</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a><span class="st">   -i, --input FILE     (required) specify input video file</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="st">   -o, --output FILE    (optional) specify output gif file</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="st">                        defaults to input file with extension changed to gif</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="st">   -s, --scale INT      (optional) specify scale of the resulting gif (affects</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a><span class="st">                        both width and height)</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a><span class="st">                        affects speed of conversion and physical size of the</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a><span class="st">                        resulting gif</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a><span class="st">                        defaults to 1</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a><span class="st">   --fps INT            (optional) specify FPS of the resulting gif</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a><span class="st">                        defaults to 24</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a><span class="st">   --pts INT            (optional) specify PTS of the resulting gif</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a><span class="st">                        affects speed of the playback</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a><span class="st">                        defaults to 1</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a><span class="st">   --default-palette    (optional) enforce default palette instead of</span></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a><span class="st">                        specially generated one, may lead to worse quality</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a><span class="st">   --compress           (optional) compress the gif to make physical size</span></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a><span class="st">                        lesser, may lead to worse quality</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="ot">-z</span> <span class="va">$INPUT</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">&quot;Missing input&quot;</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>  <span class="ex">print_usage</span></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>  <span class="bu">exit</span> 1</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="va">$INPUT</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> <span class="st">&quot;'</span><span class="va">$INPUT</span><span class="st">' is not a file&quot;</span></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>  <span class="ex">print_usage</span></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>  <span class="bu">exit</span> 1</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="ot">-z</span> <span class="va">$OUTPUT</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>  <span class="va">OUTPUT</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${INPUT</span><span class="op">%</span>.<span class="pp">*</span><span class="va">}</span><span class="st">.gif&quot;</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="va">$COMPRESS</span> <span class="ot">==</span> <span class="st">&quot;1&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>  <span class="va">OUTPUT_TEMP</span><span class="op">=</span><span class="st">&quot;tmp_</span><span class="va">$OUTPUT</span><span class="st">&quot;</span></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>  <span class="va">OUTPUT_TEMP</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$OUTPUT</span><span class="st">&quot;</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a><span class="va">PALETTE_FILE</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${INPUT</span><span class="op">%</span>.<span class="pp">*</span><span class="va">}</span><span class="st">.png&quot;</span></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a><span class="va">filters</span><span class="op">=</span><span class="st">&quot;fps=</span><span class="va">${FPS}</span><span class="st">,scale=iw*</span><span class="va">${SCALE}</span><span class="st">:ih*</span><span class="va">${SCALE}</span><span class="st">:flags=lanczos,setpts=</span><span class="va">${PTS}</span><span class="st">*PTS&quot;</span></span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;input    = </span><span class="va">${INPUT}</span><span class="st">&quot;</span></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;output   = </span><span class="va">${OUTPUT}</span><span class="st">&quot;</span></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;scale    = </span><span class="va">${SCALE}</span><span class="st">&quot;</span></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;fps      = </span><span class="va">${FPS}</span><span class="st">&quot;</span></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;pts      = </span><span class="va">${PTS}</span><span class="st">&quot;</span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;palette  = </span><span class="va">${PALETTE}</span><span class="st">&quot;</span></span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;compress = </span><span class="va">${COMPRESS}</span><span class="st">&quot;</span></span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;args     = </span><span class="va">${POSITIONAL</span><span class="op">[*]</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;filters  = </span><span class="va">$filters</span><span class="st">&quot;</span></span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span></span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> cleanup ()</span> <span class="kw">{</span></span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span> <span class="at">-f</span> <span class="st">&quot;</span><span class="va">$PALETTE_FILE</span><span class="st">&quot;</span></span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a><span class="bu">trap</span> cleanup INT TERM EXIT</span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="va">$PALETTE</span> <span class="kw">in</span></span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>  <span class="ss">custom</span><span class="kw">)</span></span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>    <span class="co"># shellcheck disable=SC2086</span></span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ffmpeg</span> <span class="va">${POSITIONAL</span><span class="op">[*]</span><span class="va">}</span> <span class="dt">\</span></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>      <span class="at">-i</span> <span class="st">&quot;</span><span class="va">$INPUT</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>      <span class="at">-vf</span> <span class="st">&quot;</span><span class="va">$filters</span><span class="st">,palettegen&quot;</span> <span class="dt">\</span></span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="va">$PALETTE_FILE</span><span class="st">&quot;</span></span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># shellcheck disable=SC2086</span></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ffmpeg</span> <span class="va">${POSITIONAL</span><span class="op">[*]</span><span class="va">}</span> <span class="dt">\</span></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>      <span class="at">-i</span> <span class="st">&quot;</span><span class="va">$INPUT</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>      <span class="at">-i</span> <span class="st">&quot;</span><span class="va">$PALETTE_FILE</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>      <span class="at">-filter_complex</span> <span class="st">&quot;</span><span class="va">$filters</span><span class="st"> [x]; [x][1:v] paletteuse&quot;</span> <span class="dt">\</span></span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="va">$OUTPUT_TEMP</span><span class="st">&quot;</span></span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">;;</span></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>  <span class="ss">default</span><span class="kw">)</span></span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># shellcheck disable=SC2086</span></span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ffmpeg</span> <span class="va">${POSITIONAL</span><span class="op">[*]</span><span class="va">}</span> <span class="dt">\</span></span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>      <span class="at">-i</span> <span class="st">&quot;</span><span class="va">$INPUT</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>      <span class="at">-filter_complex</span> <span class="st">&quot;</span><span class="va">$filters</span><span class="st">&quot;</span> <span class="dt">\</span></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="va">$OUTPUT_TEMP</span><span class="st">&quot;</span></span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">;;</span></span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a><span class="cf">esac</span></span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">[[</span> <span class="va">$COMPRESS</span> <span class="ot">==</span> <span class="st">&quot;1&quot;</span> <span class="kw">]];</span> <span class="cf">then</span></span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>  <span class="ex">gifsicle</span> <span class="at">--optimize</span><span class="op">=</span>3 <span class="at">--delay</span><span class="op">=</span>3 <span class="st">&quot;</span><span class="va">$OUTPUT_TEMP</span><span class="st">&quot;</span> <span class="at">-o</span> <span class="st">&quot;</span><span class="va">$OUTPUT</span><span class="st">&quot;</span></span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<h1 id="baf8cf36-9534-4963-a41f-365cdd5b0c68" id="more-quality">More quality</h1>
<p>In this post, I covered only quality improvements from using a custom palette. But actually, there are other ways to tweak you GIF when using FFmpeg. You can find out more in High quality GIF with FFmpeg.</p>
  </section>

  <hr />

  <section class="text-right">
    <a target="_blank" class="post-footer-sources" href="https://github.com/d12frosted/d12frosted.io/blob/master/posts/2018-10-13-gifify.org">
      <i class="fa fa-code fa-2xs"></i> Sources
    </a>
  </section>

  <script src="https://utteranc.es/client.js" repo="d12frosted/d12frosted.io" issue-term="pathname" label="comments" theme="github-light" crossorigin="anonymous" async>
  </script>
</article>

    </main>

    <footer>
      Site proudly generated by
      <a href="https://github.com/d12frosted/vulpea">Vulpea</a>,
      and
      <a href="http://jaspervdj.be/hakyll">Hakyll</a>
    </footer>

  </body>
</html>
